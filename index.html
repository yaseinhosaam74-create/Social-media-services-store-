<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social media services store    - YOURSXM</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght=400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* ================================================= */
        /* 1. CSS Styles (تصميم عصري وهادئ)                  */
        /* ================================================= */
        :root {
            --primary-color: #0077b6; 
            --secondary-color: #00b4d8; 
            --background-light: #f8f9fa; 
            --card-background: #ffffff; 
            --text-color: #343a40; 
            --shadow-subtle: 0 4px 10px rgba(0, 0, 0, 0.05); 
            --success-color: #28a745;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Cairo', sans-serif;
            direction: rtl;
            background-color: var(--background-light);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden; 
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
        }

        /* --- الهيدر العلوي --- */
        .main-header {
            background-color: var(--card-background);
            padding: 15px 30px;
            box-shadow: var(--shadow-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cart-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px; 
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s, transform 0.2s;
        }
        .cart-button:hover {
            background-color: #005f93;
            transform: translateY(-1px);
        }

        /* --- التنقل على الهاتف فقط --- */
        .menu-toggle {
            display: none; 
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 24px;
            cursor: pointer;
        }

        .mobile-nav-links {
            display: none; 
            flex-direction: column;
            background-color: #fff;
            border-top: 1px solid #eee;
            position: absolute;
            width: 100%;
            z-index: 90;
            box-shadow: var(--shadow-subtle);
        }

        .mobile-nav-links.active {
            display: flex; 
        }

        .mobile-nav-links .nav-link {
            padding: 10px 30px;
            color: var(--text-color);
            border-bottom: 1px solid #eee;
            font-weight: 500;
        }

        /* --- المحتوى الرئيسي والأقسام --- */
        .main-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-container {
            background-color: var(--card-background);
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-subtle);
        }

        .section-title {
            color: var(--primary-color);
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .current-category-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--secondary-color);
            margin-top: 20px;
            margin-bottom: 15px;
            padding-right: 5px;
        }

        /* --- أزرار تبديل الفئات (Tabs Design) --- */
        .category-navigation {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        .category-link {
            background-color: #f1f1f1;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-link:hover {
            background-color: #e9ecef;
        }

        .category-link.active {
            color: white;
            background-color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0, 119, 182, 0.4);
        }

        /* --- شبكة الخدمات والبطاقات --- */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .service-card {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 20px;
            background-color: var(--card-background);
            box-shadow: var(--shadow-subtle);
            transition: transform 0.2s;
        }

        .service-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.08);
        }

        .service-card h4 {
            font-size: 17px;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        .price-details {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 8px;
        }
        .price-details strong {
            color: #d62828; 
        }

        /* --- نموذج الإضافة للسلة --- */
        .add-to-cart-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .quantity-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            text-align: center;
        }

        .total-price-display {
            text-align: center;
            font-weight: 700;
            color: var(--secondary-color);
        }

        .add-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }

        .free-service-btn {
            background-color: #ffc107;
            color: var(--text-color);
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* --- المودال والسلة --- */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.6);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            position: relative;
        }
        .close-button {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dotted #e9ecef;
        }
        .remove-item-btn {
            background: none;
            border: none;
            color: #dc3545;
            font-weight: bold;
            cursor: pointer;
        }
        .cart-summary {
            margin-top: 20px;
            border-top: 2px solid var(--primary-color);
            padding-top: 10px;
            font-size: 18px;
            font-weight: 700;
        }
        .order-form input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 6px;
        }
        .whatsapp-confirm-btn {
            background-color: #25d366;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.2s;
        }
        
        /* --- الإشعارات العصرية (Toast Notifications) --- */
        #toast-container {
            position: fixed;
            top: 20px; 
            right: 20px; 
            z-index: 1100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast-notification {
            background-color: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
            min-width: 250px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast-notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* --- Media Queries --- */
        @media (max-width: 992px) {
            .main-header {
                padding: 15px 15px;
            }
            .main-content {
                padding: 15px;
            }
            .menu-toggle {
                display: block; 
            }
            .mobile-nav-links {
                display: none; 
            }
            .services-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
            #toast-container {
                right: 50%;
                transform: translateX(50%);
                top: auto;
                bottom: 20px;
                align-items: center;
            }
        }

        @media (max-width: 576px) {
            .services-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="logo"> Social media services store </div>
        <div class="header-actions">
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <button id="cart-btn" class="cart-button">
                <i class="fas fa-shopping-cart"></i> السلة (<span id="cart-count">0</span>)
            </button>
        </div>
    </header>

    <nav class="mobile-nav-links" id="mobile-nav">
        <a href="#payment-section" class="nav-link"><i class="fas fa-credit-card"></i> طرق الدفع</a>
        <a href="#contact-section" class="nav-link"><i class="fas fa-handshake"></i> Contact us  </a>
    </nav>

    <main class="main-content">
        
        <section id="services-section" class="section-container">
            <h2 class="section-title"><i class="fas fa-cogs"></i> جميع خدماتنا</h2>
            
            <nav class="category-navigation" id="category-navigation">
                <button class="category-link active" data-category="tiktok">
                    <i class="fab fa-tiktok"></i>  Tik Tok
                </button>
                <button class="category-link" data-category="instagram">
                    <i class="fab fa-instagram"></i> Instagram 
                </button>
                <button class="category-link" data-category="telegram">
                    <i class="fab fa-telegram-plane"></i> Telegram 
                </button>
                <button class="category-link" data-category="free">
                    <i class="fas fa-gift"></i> For Free 
                </button>
            </nav>

            <h3 class="current-category-title" id="current-category-title"> TikTok services  </h3>
            
            <div class="services-grid" id="services-grid">
                </div>
        </section>

        <section id="payment-section" class="section-container payment-details-section">
            <h2 class="section-title"><i class="fas fa-money-check-alt"></i> طرق الدفع المتاحة</h2>
            <div class="payment-card">
                <h3>اتصالات كاش (Etisalat Cash)</h3>
                <p><strong>رقم المحفظة:</strong> <span>01121454510</span></p>
                <p class="note">يرجى التحويل إلى هذا الرقم وإرفاق صورة بالتحويل في رسالة الطلب عبر واتساب.</p>
            </div>
        </section>
        
        <section id="contact-section" class="section-container contact-section">
            <h2 class="section-title"><i class="fas fa-code"></i>   Contact the developer  (yaseinhsied)</h2>
            <div class="social-links-container">
                <a href="https://www.instagram.com/_yaseinhsied?igsh=MXJpbGs2ZXdwa2E2" target="_blank" class="social-btn instagram-btn">
                    <i class="fab fa-instagram"></i> Instagram 
                </a>
                <a href="https://wa.me/+2001121454510" target="_blank" class="social-btn whatsapp-btn">
                    <i class="fab fa-whatsapp"></i>  WhatsApp Developer 
                </a>
            </div>
        </section>
        
        <footer>
            <p>&copy; 2025. جميع الحقوق محفوظة | تطوير وتصميم: <a href="https://www.instagram.com/_yaseinhsied?igsh=MXJpbGs2ZXdwa2E2" target="_blank">yaseinhsied</a></p>
        </footer>

    </main>

    <div id="cart-modal" class="modal">
        <div class="modal-content cart-content">
            <span class="close-button">&times;</span>
            <h3>سلة الخدمات</h3>
            
            <div id="cart-items-list" class="cart-items-list">
                </div>

            <div class="cart-summary">
                <p>الإجمالي المطلوب: <span id="cart-total-price">0.00</span> جنيه</p>
            </div>

            <form id="order-form" class="order-form">
                <h4>تفاصيل العميل</h4>
                <input type="text" id="client-name" placeholder="الاسم الكامل" required>
                <input type="tel" id="client-phone" placeholder="رقم واتساب للتواصل" required>
                <input type="text" id="client-link" placeholder="رابط الحساب/المنشور المطلوب (لإتمام الخدمة)" required>
                
                <button type="submit" class="whatsapp-confirm-btn">
                    <i class="fab fa-whatsapp"></i> تأكيد الطلب عبر واتساب
                </button>
            </form>
        </div>
    </div>
    
    <div id="toast-container"></div>

    <script>
        
        // 1. قاعدة بيانات الخدمات (تم تحديثها بناءً على الصور المرفقة)
        const servicesData = {
            free: [
                { id: 'f1', name: "مشتركين تليجرام ثابت 100% (مجاني)", platform: "telegram", isPaid: false, description: "خدمة مجانية لزيادة مشتركين قناتك." },
                { id: 'f2', name: "مشاهدات فيديو ريلز انستجرام (مجاني)", platform: "instagram", isPaid: false, description: "مشاهدات مجانية لفيديوهات الريلز." },
                { id: 'f3', name: "مشاهدات فيديو تيك توك عرب (مجاني)", platform: "tiktok", isPaid: false, description: "مشاهدات مجانية لفيديوهات تيك توك." },
                { id: 'f4', name: "تفاعل بوست تليجرام (مجاني)", platform: "telegram", isPaid: false, description: "تفاعلات مجانية على منشورات تليجرام." },
                { id: 'f5', name: "الإبلاغ عن حساب (مجاني)", platform: "any", isPaid: false, description: "خدمة الإبلاغ عن حسابات انستجرام/تيك توك/تويتر/فيسبوك/تليجرام/يوتيوب." }
            ],
            tiktok: [
                { id: 't1', name: "متابعين تيك توك الارخص بالعالم ثابت", pricePer1000: 300, minOrder: 100, maxOrder: 1000, platform: "tiktok", isPaid: true },
                { id: 't2', name: "متابعين تيك توك الارخص بالعالم VIP", pricePer1000: 450, minOrder: 100, maxOrder: 1000, platform: "tiktok", isPaid: true },
                { id: 't3', name: "مشاهدات فيديو تيك توك رخيص", pricePer1000: 50, minOrder: 100, maxOrder: 10000, platform: "tiktok", isPaid: true },
                { id: 't4', name: "لايكات فيديو تيك توك حقيقي (MX)", pricePer1000: 150, minOrder: 50, maxOrder: 5000, platform: "tiktok", isPaid: true },
                { id: 't5', name: "لايكات فيديو تيك توك حقيقي (VIP)", pricePer1000: 250, minOrder: 50, maxOrder: 5000, platform: "tiktok", isPaid: true },
                { id: 't6', name: "زيادة اكسبلور فيديو تيك توك (الارخص)", pricePer1000: 100, minOrder: 100, maxOrder: 10000, platform: "tiktok", isPaid: true },
                { id: 't7', name: "مشاهدات ستوري تيك توك (الارخص)", pricePer1000: 40, minOrder: 100, maxOrder: 10000, platform: "tiktok", isPaid: true },
            ],
            instagram: [
                { id: 'i1', name: "لايكات منشور انستقرام (فوري وسريع) VIP", pricePer1000: 150, minOrder: 50, maxOrder: 1000, platform: "instagram", isPaid: true },
                { id: 'i2', name: "لايكات منشور انستقرام (فوري) VIP", pricePer1000: 120, minOrder: 50, maxOrder: 1000, platform: "instagram", isPaid: true },
                { id: 'i3', name: "تعليقات منشور انستقرام الارخص عشوائي", pricePer1000: 100, minOrder: 10, maxOrder: 1000, platform: "instagram", isPaid: true },
                { id: 'i4', name: "مشاهدات ستوري انستا (لجميع القصص) الارخص", pricePer1000: 50, minOrder: 50, maxOrder: 1000, platform: "instagram", isPaid: true },
                { id: 'i5', name: "مشاهدات فيديو ريلز انستقرام (رخيص)", pricePer1000: 40, minOrder: 100, maxOrder: 10000, platform: "instagram", isPaid: true },
            ],
            telegram: [
                { id: 'l1', name: "أعضاء قناة تليجرام VIP", pricePer1000: 250, minOrder: 100, maxOrder: 5000, platform: "telegram", isPaid: true },
                { id: 'l2', name: "أعضاء قناة تليجرام حقيقي ثابت (عراقي)", pricePer1000: 350, minOrder: 50, maxOrder: 1000, platform: "telegram", isPaid: true },
                { id: 'l3', name: "مشاهدات بوست تليجرام عرب", pricePer1000: 80, minOrder: 100, maxOrder: 10000, platform: "telegram", isPaid: true },
            ]
        };

        const DEVELOPER_PHONE = '+2001121454510';
        const CURRENCY = 'جنيه';
        const CATEGORY_NAMES = {
            tiktok: 'خدمات تيك توك',
            instagram: 'خدمات انستجرام',
            telegram: 'خدمات تليجرام',
            free: 'الخدمات المجانية'
        };

        let currentCart = [];
        let currentCategory = 'tiktok'; 

        // 2. دالة عرض الإشعار العصري (Toast Notification)
        function showToast(message, isError = false) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.classList.add('toast-notification');
            if (isError) {
                toast.style.backgroundColor = '#dc3545'; // لون أحمر للأخطاء
            }
            
            const icon = isError ? '<i class="fas fa-times-circle"></i>' : '<i class="fas fa-check-circle"></i>';
            toast.innerHTML = `${icon} <span>${message}</span>`;
            
            container.appendChild(toast);

            // إظهار الإشعار
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            // إخفاء وحذف الإشعار بعد 3 ثواني
            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => {
                    toast.remove();
                });
            }, 3000);
        }

        // --- باقي الدوال كما هي مع تعديل `alert()` إلى `showToast()` ---

        function generateUniqueOrderId() {
            const now = new Date();
            const datePart = now.getFullYear().toString() + 
                             (now.getMonth() + 1).toString().padStart(2, '0') + 
                             now.getDate().toString().padStart(2, '0');
            const randomPart = Math.random().toString(36).substring(2, 6).toUpperCase();
            return `ORDER-${datePart}-${randomPart}`;
        }

        function calculateTotal(quantity, pricePer1000) {
            if (quantity <= 0 || pricePer1000 <= 0) return 0;
            const unitPrice = pricePer1000 / 1000;
            const totalPrice = unitPrice * quantity;
            return parseFloat(totalPrice.toFixed(2));
        }

        function validateQuantity(quantity, minOrder, maxOrder) {
            if (!Number.isInteger(quantity) || quantity <= 0) {
                return 'الكمية يجب أن تكون رقمًا صحيحًا موجبًا.';
            }
            if (quantity < minOrder) {
                return `الحد الأدنى للطلب هو: ${minOrder}.`;
            }
            if (quantity > maxOrder) {
                return `الحد الأقصى للطلب هو: ${maxOrder}.`;
            }
            return null; 
        }

        const DOM = {};
        function setupDOM() {
            DOM.servicesGrid = document.getElementById('services-grid');
            DOM.cartCountSpan = document.getElementById('cart-count');
            DOM.cartModal = document.getElementById('cart-modal');
            DOM.closeModal = document.querySelector('#cart-modal .close-button');
            DOM.cartItemsList = document.getElementById('cart-items-list');
            DOM.cartTotalPriceSpan = document.getElementById('cart-total-price');
            DOM.orderForm = document.getElementById('order-form');
            DOM.categoryTitle = document.getElementById('current-category-title');
            DOM.menuToggle = document.getElementById('menu-toggle');
            DOM.mobileNav = document.getElementById('mobile-nav');
            DOM.categoryLinks = document.querySelectorAll('.category-link');
            DOM.cartBtn = document.getElementById('cart-btn');
        }

        function renderServices(category) {
            if (!DOM.servicesGrid) return;
            
            DOM.servicesGrid.innerHTML = '';
            const services = servicesData[category] || [];
            DOM.categoryTitle.textContent = CATEGORY_NAMES[category];

            if (services.length === 0) {
                DOM.servicesGrid.innerHTML = `<p style="text-align: center; color: #999;">لا توجد خدمات متاحة حاليًا في فئة "${CATEGORY_NAMES[category]}".</p>`;
                return;
            }

            services.forEach(service => {
                const defaultQuantity = service.isPaid ? service.minOrder : 1;
                const total = service.isPaid ? calculateTotal(defaultQuantity, service.pricePer1000) : 0;
                
                const card = document.createElement('div');
                card.classList.add('service-card');

                let cardContent = `<h4>${service.name}</h4>`;

                if (service.isPaid) {
                    cardContent += `
                        <p class="price-details">سعر 1000: <strong>${service.pricePer1000}</strong> ${CURRENCY}</p>
                        <p class="price-details">الحدود: ${service.minOrder} - ${service.maxOrder}</p>
                        
                        <form class="add-to-cart-form" data-service-id="${service.id}">
                            <input type="number" class="quantity-input" min="${service.minOrder}" max="${service.maxOrder}" 
                                   placeholder="أدخل الكمية" required value="${defaultQuantity}">
                            
                            <p class="total-price-display">الإجمالي: <span class="total-price-value">${total.toFixed(2)}</span> ${CURRENCY}</p>
                            
                            <button type="submit" class="add-btn">إضافة إلى السلة</button>
                        </form>
                    `;
                } else {
                    cardContent += `
                        <p class="price-details">${service.description}</p>
                        <button type="button" class="free-service-btn" data-service-id="${service.id}" data-service-name="${service.name}">
                            طلب الخدمة المجانية
                        </button>
                    `;
                }

                card.innerHTML = cardContent;
                DOM.servicesGrid.appendChild(card);
            });

            attachDynamicServiceListeners(services);
        }

        function updateCartDisplay() {
            if (!DOM.cartCountSpan || !DOM.cartItemsList || !DOM.cartTotalPriceSpan) return;

            DOM.cartCountSpan.textContent = currentCart.length;
            DOM.cartItemsList.innerHTML = '';
            let total = 0;

            if (currentCart.length === 0) {
                DOM.cartItemsList.innerHTML = '<p class="empty-cart-message">السلة فارغة حاليًا.</p>';
                DOM.cartTotalPriceSpan.textContent = '0.00';
                return;
            }

            currentCart.forEach(item => {
                total += item.price;
                const itemElement = document.createElement('div');
                itemElement.classList.add('cart-item');
                const priceText = item.price > 0 ? `${item.price.toFixed(2)} ${CURRENCY}` : 'مجاني';
                
                itemElement.innerHTML = `
                    <span>${item.name} (${item.quantity}) - ${priceText}</span>
                    <button class="remove-item-btn" data-service-id="${item.uniqueId || item.serviceId}">&times;</button>
                `;
                DOM.cartItemsList.appendChild(itemElement);
            });

            DOM.cartTotalPriceSpan.textContent = total.toFixed(2);
            
            document.querySelectorAll('.remove-item-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.dataset.serviceId;
                    removeFromCart(id);
                });
            });
        }
        
        function addToCart(item) {
            item.uniqueId = item.uniqueId || item.serviceId; 
            
            if (item.price > 0) {
                 const existingItemIndex = currentCart.findIndex(i => i.serviceId === item.serviceId);
                
                if (existingItemIndex !== -1) {
                    currentCart[existingItemIndex].quantity += item.quantity;
                    currentCart[existingItemIndex].price += item.price;
                } else {
                    currentCart.push(item);
                }
            } else {
                item.uniqueId = `free-${item.serviceId}-${Date.now()}`;
                currentCart.push(item);
            }
            
            updateCartDisplay();
        }

        function removeFromCart(id) {
            currentCart = currentCart.filter(item => (item.uniqueId || item.serviceId) !== id);
            updateCartDisplay();
        }

        function attachDynamicServiceListeners(services) {
            // 7.1. ربط حقول الكمية وأزرار الإضافة للسلة (للقسم المدفوع)
            document.querySelectorAll('.add-to-cart-form').forEach(form => {
                const input = form.querySelector('.quantity-input');
                const totalPriceDisplay = form.querySelector('.total-price-value');
                const serviceId = form.dataset.serviceId;
                const service = services.find(s => s.id === serviceId);

                // حدث تحديث السعر عند تغيير الكمية
                input.addEventListener('input', () => {
                    const quantity = parseInt(input.value);
                    
                    if (service && !isNaN(quantity) && quantity > 0) {
                        const error = validateQuantity(quantity, service.minOrder, service.maxOrder);
                        if (error) {
                            totalPriceDisplay.textContent = 'خطأ'; 
                            totalPriceDisplay.style.color = 'red';
                            // استخدام showToast عند وجود خطأ
                            showToast(`خطأ في الكمية: ${error}`, true);
                        } else {
                            const total = calculateTotal(quantity, service.pricePer1000);
                            totalPriceDisplay.textContent = total.toFixed(2);
                            totalPriceDisplay.style.color = '#00b4d8'; 
                        }
                    } else if (quantity <= 0) {
                         totalPriceDisplay.textContent = '0.00'; 
                         totalPriceDisplay.style.color = '#00b4d8'; 
                    }
                });
                
                // حدث الإضافة إلى السلة
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const quantity = parseInt(input.value);
                    const error = validateQuantity(quantity, service.minOrder, service.maxOrder);

                    if (error) {
                        // استخدام showToast عند وجود خطأ
                        showToast(`خطأ في الكمية: ${error}`, true);
                        return;
                    }
                    
                    const item = {
                        serviceId: service.id,
                        name: service.name,
                        quantity: quantity,
                        pricePer1000: service.pricePer1000,
                        price: calculateTotal(quantity, service.pricePer1000)
                    };
                    addToCart(item);
                    // استخدام showToast بدلاً من alert()
                    showToast(`تمت إضافة ${quantity} من خدمة "${service.name}" إلى السلة.`);
                });
            });

            // 7.2. ربط أزرار الخدمات المجانية
            document.querySelectorAll('.free-service-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const serviceName = e.target.dataset.servicename; 
                    const serviceId = e.target.dataset.serviceId;
                    
                     const freeItem = {
                        serviceId: serviceId,
                        name: serviceName,
                        quantity: 1,
                        pricePer1000: 0,
                        price: 0
                    };
                    addToCart(freeItem);
                    // استخدام showToast بدلاً من alert()
                    showToast(`تمت إضافة خدمة "${serviceName}" المجانية إلى السلة.`);
                });
            });
        }


        function initEvents() {
            // تبديل الفئات
            DOM.categoryLinks.forEach(button => {
                button.addEventListener('click', (e) => {
                    DOM.categoryLinks.forEach(btn => btn.classList.remove('active'));
                    e.currentTarget.classList.add('active'); 
                    
                    currentCategory = e.currentTarget.dataset.category;
                    renderServices(currentCategory); 
                    
                    document.getElementById('services-section').scrollIntoView({ behavior: 'smooth' });
                });
            });

            // إظهار قائمة الهاتف
            DOM.menuToggle.addEventListener('click', () => {
                DOM.mobileNav.classList.toggle('active');
            });

            // فتح وإغلاق السلة
            DOM.cartBtn.addEventListener('click', () => {
                if(DOM.mobileNav.classList.contains('active')) {
                    DOM.mobileNav.classList.remove('active');
                }
                DOM.cartModal.style.display = 'block';
            });

            DOM.closeModal.onclick = function() {
                DOM.cartModal.style.display = 'none';
            };

            window.onclick = function(event) {
                if (event.target == DOM.cartModal) {
                    DOM.cartModal.style.display = 'none';
                }
            };
            
            // تأكيد الطلب والتحويل إلى واتساب
            DOM.orderForm.addEventListener('submit', (e) => {
                e.preventDefault();

                if (currentCart.length === 0) {
                    // استخدام showToast عند السلة الفارغة
                    showToast("سلة الخدمات فارغة. يرجى إضافة خدمة واحدة على الأقل.", true);
                    return;
                }
                
                const clientName = document.getElementById('client-name').value;
                const clientPhone = document.getElementById('client-phone').value;
                const clientLink = document.getElementById('client-link').value;
                const totalPriceText = DOM.cartTotalPriceSpan.textContent;
                const totalPrice = parseFloat(totalPriceText); 
                const orderId = generateUniqueOrderId(); 

                
                // بناء رسالة واتساب
                let message = `*✅ طلب أوردر جديد (مُؤكد) ✅*\n`;
                message += `------------------------------------\n`;
                message += `*كود الطلب/الاستلام*: ${orderId}\n`;
                message += `*الاسم*: ${clientName}\n`;
                message += `*رقم التواصل (واتساب)*: ${clientPhone}\n`;
                message += `*رابط الخدمة/الحساب*: ${clientLink}\n\n`; 
                message += `*تفاصيل الخدمات المطلوبة*:\n`;

                currentCart.forEach((item, index) => {
                    const priceDetail = item.price > 0 ? ` - *السعر*: ${item.price.toFixed(2)} ${CURRENCY}` : ` (خدمة مجانية)`;
                    message += `${index + 1}. *الخدمة*: ${item.name}\n`;
                    message += `   - *الكمية*: ${item.quantity} وحدات ${priceDetail}\n`;
                });

                message += `------------------------------------\n`;
                
                if (totalPrice === 0) {
                    message += `*نوع الطلب*: *طلب خدمات مجانية بالكامل*`;
                    message += `\n\nشكراً لك! سيتم مراجعة طلبك وبدء التنفيذ مباشرةً.`;
                } else {
                    message += `*الإجمالي النهائي*: *${totalPriceText} ${CURRENCY}*`;
                    message += `\n\nيرجى إرسال إثبات التحويل على رقم اتصالات كاش (+2001121454510) لتأكيد بدء التنفيذ.`;
                }

                const encodedMessage = encodeURIComponent(message);
                const whatsappLink = `https://wa.me/${DEVELOPER_PHONE}?text=${encodedMessage}`;

                window.open(whatsappLink, '_blank');
                
                // عرض إشعار نجاح الطلب
                showToast("تم إرسال طلبك بنجاح! سيتم تحويلك إلى واتساب.", false);

                // تفريغ السلة بعد الطلب
                currentCart = [];
                updateCartDisplay();
                DOM.cartModal.style.display = 'none';
            });
        }


        // 9. تشغيل الموقع عند التحميل
        document.addEventListener('DOMContentLoaded', () => {
            setupDOM();
            initEvents();
            renderServices(currentCategory); 
            updateCartDisplay();
        });
    </script>
</body>
</html>
